{"ast":null,"code":"import Keycloak from 'keycloak-js';\nimport axios from 'axios';\n\n// Debugging helper - add this right after your imports\nfunction debugLog(...args) {\n  console.log('[Keycloak Debug]', ...args);\n}\n\n// Keycloak initialization options\nconst keycloakConfig = {\n  url: 'http://localhost:8080',\n  realm: 'areti-alliance',\n  clientId: 'areti-crm-client'\n};\n\n// Initialize Keycloak\nconst keycloak = new Keycloak(keycloakConfig);\n\n// Authentication service\nconst AuthService = {\n  // Initialize Keycloak\n  init: () => {\n    debugLog('Initializing Keycloak');\n    return new Promise((resolve, reject) => {\n      keycloak.init({\n        onLoad: 'check-sso',\n        silentCheckSsoRedirectUri: window.location.origin + '/silent-check-sso.html',\n        pkceMethod: 'S256',\n        enableLogging: true\n      }).then(authenticated => {\n        debugLog('Keycloak initialized, authenticated:', authenticated);\n        if (authenticated) {\n          debugLog('User is authenticated, token exists:', !!keycloak.token);\n          // Exchange Keycloak token for app session token\n          AuthService.exchangeToken().then(() => {\n            debugLog('Token exchange successful');\n            resolve(authenticated);\n          }).catch(err => {\n            debugLog('Token exchange error:', err);\n            resolve(false);\n          });\n        } else {\n          debugLog('User is not authenticated');\n          resolve(authenticated);\n        }\n      }).catch(error => {\n        debugLog('Keycloak init error:', error);\n        reject(error);\n      });\n    });\n  },\n  // Log in\n  login: () => {\n    debugLog('Starting login process');\n    keycloak.login();\n  },\n  // Log out\n  logout: () => {\n    debugLog('Logging out');\n    // Clear local tokens\n    localStorage.removeItem('aretiUser');\n    // Logout from Keycloak\n    keycloak.logout();\n  },\n  // Check if authenticated\n  isAuthenticated: () => {\n    const hasToken = !!keycloak.token;\n    debugLog('Checking if authenticated:', hasToken);\n    return hasToken;\n  },\n  // Exchange Keycloak token for app session token\n  exchangeToken: async () => {\n    try {\n      var _keycloak$token;\n      debugLog('Starting token exchange, token exists:', !!keycloak.token);\n      debugLog('Token length:', (_keycloak$token = keycloak.token) === null || _keycloak$token === void 0 ? void 0 : _keycloak$token.length);\n      const authServiceUrl = 'http://localhost:4000';\n      debugLog('Posting to auth service:', `${authServiceUrl}/auth/token`);\n      const response = await axios.post(`${authServiceUrl}/auth/token`, {\n        token: keycloak.token\n      });\n      debugLog('Auth service response:', response.data);\n      const {\n        token\n      } = response.data;\n\n      // Parse token to get user info\n      const base64Url = token.split('.')[1];\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n      const payload = JSON.parse(window.atob(base64));\n      debugLog('Parsed token payload:', payload);\n\n      // Store in localStorage\n      const userInfo = {\n        email: payload.email,\n        name: payload.name,\n        role: payload.role,\n        token: token,\n        timestamp: new Date().getTime()\n      };\n      debugLog('Storing user info in localStorage:', userInfo);\n      localStorage.setItem('aretiUser', JSON.stringify(userInfo));\n      return token;\n    } catch (error) {\n      debugLog('Token exchange error:', error);\n      if (error.response) {\n        debugLog('Error response:', error.response.data);\n        debugLog('Error status:', error.response.status);\n      }\n      throw error;\n    }\n  },\n  // Get user profile\n  getUserProfile: () => {\n    const user = localStorage.getItem('aretiUser');\n    debugLog('Getting user profile from localStorage:', user ? 'found' : 'not found');\n    return user ? JSON.parse(user) : null;\n  },\n  // Check if token is valid\n  hasValidToken: () => {\n    const user = localStorage.getItem('aretiUser');\n    if (!user) {\n      debugLog('No user in localStorage');\n      return false;\n    }\n    const userData = JSON.parse(user);\n    const now = new Date().getTime();\n    // Check if token is expired (24 hour validity)\n    const isValid = now - userData.timestamp < 24 * 60 * 60 * 1000;\n    debugLog('Token valid:', isValid);\n    return isValid;\n  },\n  // Get authorization header\n  getAuthHeader: () => {\n    const user = localStorage.getItem('aretiUser');\n    if (!user) {\n      debugLog('No user in localStorage for auth header');\n      return {};\n    }\n    const userData = JSON.parse(user);\n    debugLog('Created auth header with token');\n    return {\n      'Authorization': `Bearer ${userData.token}`\n    };\n  }\n};\nexport default AuthService;","map":{"version":3,"names":["Keycloak","axios","debugLog","args","console","log","keycloakConfig","url","realm","clientId","keycloak","AuthService","init","Promise","resolve","reject","onLoad","silentCheckSsoRedirectUri","window","location","origin","pkceMethod","enableLogging","then","authenticated","token","exchangeToken","catch","err","error","login","logout","localStorage","removeItem","isAuthenticated","hasToken","_keycloak$token","length","authServiceUrl","response","post","data","base64Url","split","base64","replace","payload","JSON","parse","atob","userInfo","email","name","role","timestamp","Date","getTime","setItem","stringify","status","getUserProfile","user","getItem","hasValidToken","userData","now","isValid","getAuthHeader"],"sources":["C:/Users/Administrator/Desktop/aretialliance/areti-dash-crm/src/services/keycloak.js"],"sourcesContent":["import Keycloak from 'keycloak-js';\r\nimport axios from 'axios';\r\n\r\n// Debugging helper - add this right after your imports\r\nfunction debugLog(...args) {\r\n  console.log('[Keycloak Debug]', ...args);\r\n}\r\n\r\n// Keycloak initialization options\r\nconst keycloakConfig = {\r\n  url: 'http://localhost:8080',\r\n  realm: 'areti-alliance',\r\n  clientId: 'areti-crm-client'\r\n};\r\n\r\n// Initialize Keycloak\r\nconst keycloak = new Keycloak(keycloakConfig);\r\n\r\n// Authentication service\r\nconst AuthService = {\r\n  // Initialize Keycloak\r\n  init: () => {\r\n    debugLog('Initializing Keycloak');\r\n    return new Promise((resolve, reject) => {\r\n      keycloak.init({\r\n        onLoad: 'check-sso',\r\n        silentCheckSsoRedirectUri: window.location.origin + '/silent-check-sso.html',\r\n        pkceMethod: 'S256',\r\n        enableLogging: true\r\n      })\r\n        .then(authenticated => {\r\n          debugLog('Keycloak initialized, authenticated:', authenticated);\r\n          if (authenticated) {\r\n            debugLog('User is authenticated, token exists:', !!keycloak.token);\r\n            // Exchange Keycloak token for app session token\r\n            AuthService.exchangeToken().then(() => {\r\n              debugLog('Token exchange successful');\r\n              resolve(authenticated);\r\n            }).catch(err => {\r\n              debugLog('Token exchange error:', err);\r\n              resolve(false);\r\n            });\r\n          } else {\r\n            debugLog('User is not authenticated');\r\n            resolve(authenticated);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          debugLog('Keycloak init error:', error);\r\n          reject(error);\r\n        });\r\n    });\r\n  },\r\n\r\n  // Log in\r\n  login: () => {\r\n    debugLog('Starting login process');\r\n    keycloak.login();\r\n  },\r\n\r\n  // Log out\r\n  logout: () => {\r\n    debugLog('Logging out');\r\n    // Clear local tokens\r\n    localStorage.removeItem('aretiUser');\r\n    // Logout from Keycloak\r\n    keycloak.logout();\r\n  },\r\n\r\n  // Check if authenticated\r\n  isAuthenticated: () => {\r\n    const hasToken = !!keycloak.token;\r\n    debugLog('Checking if authenticated:', hasToken);\r\n    return hasToken;\r\n  },\r\n\r\n  // Exchange Keycloak token for app session token\r\n  exchangeToken: async () => {\r\n    try {\r\n      debugLog('Starting token exchange, token exists:', !!keycloak.token);\r\n      debugLog('Token length:', keycloak.token?.length);\r\n      \r\n      const authServiceUrl = 'http://localhost:4000';\r\n      \r\n      debugLog('Posting to auth service:', `${authServiceUrl}/auth/token`);\r\n      const response = await axios.post(`${authServiceUrl}/auth/token`, {\r\n        token: keycloak.token\r\n      });\r\n      \r\n      debugLog('Auth service response:', response.data);\r\n      \r\n      const { token } = response.data;\r\n      \r\n      // Parse token to get user info\r\n      const base64Url = token.split('.')[1];\r\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n      const payload = JSON.parse(window.atob(base64));\r\n      \r\n      debugLog('Parsed token payload:', payload);\r\n      \r\n      // Store in localStorage\r\n      const userInfo = {\r\n        email: payload.email,\r\n        name: payload.name,\r\n        role: payload.role,\r\n        token: token,\r\n        timestamp: new Date().getTime()\r\n      };\r\n      \r\n      debugLog('Storing user info in localStorage:', userInfo);\r\n      localStorage.setItem('aretiUser', JSON.stringify(userInfo));\r\n      \r\n      return token;\r\n    } catch (error) {\r\n      debugLog('Token exchange error:', error);\r\n      if (error.response) {\r\n        debugLog('Error response:', error.response.data);\r\n        debugLog('Error status:', error.response.status);\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Get user profile\r\n  getUserProfile: () => {\r\n    const user = localStorage.getItem('aretiUser');\r\n    debugLog('Getting user profile from localStorage:', user ? 'found' : 'not found');\r\n    return user ? JSON.parse(user) : null;\r\n  },\r\n\r\n  // Check if token is valid\r\n  hasValidToken: () => {\r\n    const user = localStorage.getItem('aretiUser');\r\n    if (!user) {\r\n      debugLog('No user in localStorage');\r\n      return false;\r\n    }\r\n    \r\n    const userData = JSON.parse(user);\r\n    const now = new Date().getTime();\r\n    // Check if token is expired (24 hour validity)\r\n    const isValid = now - userData.timestamp < 24 * 60 * 60 * 1000;\r\n    debugLog('Token valid:', isValid);\r\n    return isValid;\r\n  },\r\n\r\n  // Get authorization header\r\n  getAuthHeader: () => {\r\n    const user = localStorage.getItem('aretiUser');\r\n    if (!user) {\r\n      debugLog('No user in localStorage for auth header');\r\n      return {};\r\n    }\r\n    \r\n    const userData = JSON.parse(user);\r\n    debugLog('Created auth header with token');\r\n    return {\r\n      'Authorization': `Bearer ${userData.token}`\r\n    };\r\n  }\r\n};\r\n\r\nexport default AuthService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}